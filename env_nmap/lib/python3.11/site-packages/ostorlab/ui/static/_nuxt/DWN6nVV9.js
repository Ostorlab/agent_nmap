import{u as S}from"./Ditas79l.js";import{d as D,L as $,M,v as m,z as t,N as i,A as o,O as g,i as c,t as r,V as C,P as _,Q as N,R as G,S as V,B as d,y as v,T as k,U as b,W as w,X as T,Y as E}from"./BuiHH9If.js";import{u as I,V as f,D as P,a as Y,b as R,c as z}from"./DgDmD7eB.js";import{Y as K}from"./Dyb1gHC6.js";import{A as W}from"./C4dqYdlo.js";import{A as O}from"./PpeMCrAR.js";import{D as U,V as Q}from"./C1DT9QDp.js";import{_ as F}from"./DlAUqK2U.js";import{S as X}from"./BY0pkBHE.js";import{V as j}from"./BMT2dgHV.js";import"./DppDgiI5.js";import"./VWuwDkxo.js";import"./CvoSsIOf.js";import"./BvH6OxSR.js";const q=D({components:{DfConfirmationModal:U,AgentGroupForm:W},data(){return{loading:!0,agentGroupService:new O(this.$axios),agentGroups:[],headers:[{title:"Key",align:"left",sortable:!1,key:"key",width:"10%"},{title:"Description",align:"left",sortable:!1,key:"description",width:"14%"},{title:"Agents",align:"left",sortable:!1,key:"agents",width:"20%"},{title:"Actions",align:"left",sortable:!1,key:"actions",width:"5%"}],onActionAgentGroup:null,itemsPerPage:15,editorLanguage:"yaml",editorOptions:{theme:"vs",wordWrap:"on",wordWrapColumn:"on",fontFamily:"Fira Code",automaticLayout:!0,minimap:{enabled:!1}},deleteAgentGroupDialog:!1,showForm:!1,selectedAgentGroup:null,expandedItem:null}},computed:{...$(S,["scanners"]),actions(){return[{title:"Edit",action:e=>this.updateAgentGroup(e),icon:"mdi-pencil-outline",color:"primary",divider:!0},{title:"Delete",action:e=>this.deleteAgentGroup(e),icon:"mdi-delete",color:"red"}]}},watch:{selectedAgentGroup(e){this.selectedAgentGroup=e}},mounted(){this.fetchAgentGroups()},methods:{...M(I,["reportSuccess","reportError"]),async fetchAgentGroups(){this.agentGroups=[],this.loading=!0;try{const e=this.scanners.map(async n=>{try{const a=await this.agentGroupService.getAgentGroups(n);Array.isArray(a)==!0&&this.agentGroups.push(...a.map(l=>({...l,scanner:n})))}catch(a){this.reportError((a==null?void 0:a.message)||"Error fetching agent groups")}});await Promise.allSettled(e)}finally{this.loading=!1}},parseYaml(e){try{return K.parse(e).agents||[]}catch{return[]}},getVisibleAgents(e){return this.parseYaml(e).slice(0,4)},getRemainingCount(e){const n=this.parseYaml(e);return Math.max(0,n.length-4)},deleteAgentGroup(e){this.onActionAgentGroup=e,this.deleteAgentGroupDialog=!0},async confirmDeleteAgentGroup(){if(this.onActionAgentGroup!=null)try{this.loading=!0,this.onActionAgentGroup!==null&&this.onActionAgentGroup.id!==void 0&&(await this.agentGroupService.deleteAgentGroup(this.onActionAgentGroup.scanner,parseInt(this.onActionAgentGroup.id)),this.reportSuccess("Agent group deleted successfully"),this.agentGroups=this.agentGroups.filter(e=>{var n;return e.id!==((n=this.onActionAgentGroup)==null?void 0:n.id)}))}catch(e){this.reportError((e==null?void 0:e.message)||"An error occurred while deleting the agent group")}finally{this.onActionAgentGroup=null,this.loading=!1}},updateAgentGroup(e){this.selectedAgentGroup=e,this.showForm=!0,window.scrollTo({top:0,behavior:"smooth"})},onCloseForm(){this.showForm=!1,this.selectedAgentGroup=null,this.loading=!0,this.fetchAgentGroups()},formatAgentKey(e){const n=e.split("/"),a=n[1],l=n[2];return a==="ostorlab"?`@${l}`:`@${a}/${l}`},createAgentGroup(e){return e!==null&&e.id!==null&&e.id!==void 0?{id:e.id,name:e.name,key:e.key,yamlSource:e.yamlSource,description:e.description,agents:{agents:[]}}:null}}});function H(e,n,a,l,L,B){const h=c("DfConfirmationModal"),A=c("AgentGroupForm"),y=c("v-list-item-content");return r(),m("div",null,[t(h,{modelValue:e.deleteAgentGroupDialog,"onUpdate:modelValue":n[0]||(n[0]=s=>e.deleteAgentGroupDialog=s),title:"Are you sure you would like to delete this Agent group?","cancel-button-text":"Cancel","confirm-button-text":"Delete","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-delete-outline",onConfirm:e.confirmDeleteAgentGroup},null,8,["modelValue","onConfirm"]),e.showForm===!0?(r(),i(f,{key:0,variant:"outlined",class:"pa-4 mb-4"},{default:o(()=>{var s;return[t(A,{"agent-group":e.createAgentGroup(e.selectedAgentGroup),scanner:(s=e.selectedAgentGroup)==null?void 0:s.scanner,"is-edit-mode":!0,onCloseForm:e.onCloseForm},null,8,["agent-group","scanner","onCloseForm"])]}),_:1})):g("",!0),t(f,{variant:"outlined"},{default:o(()=>[t(Q,{loading:e.loading,hover:"",headers:e.headers,items:e.agentGroups,"items-per-page-options":[15,50,200,-1],"items-per-page":e.itemsPerPage,density:"comfortable"},{"item.agents":o(({item:s})=>[t(C,{dense:""},{default:o(()=>[t(_,null,{default:o(()=>[t(y,null,{default:o(()=>[t(N,{class:"chip-container"},{default:o(()=>[(r(!0),m(G,null,V(e.getVisibleAgents(s.yamlSource),(u,p)=>(r(),i(k,{key:p,class:"mr-1"},{default:o(()=>[d(v(e.formatAgentKey(u.key)),1)]),_:2},1024))),128)),e.getRemainingCount(s.yamlSource)>0?(r(),i(k,{key:0,class:"mr-1",color:"grey lighten-2","text-color":"black",style:{"min-width":"50px",padding:"0 12px"}},{default:o(()=>[d(" +"+v(e.getRemainingCount(s.yamlSource)),1)]),_:2},1024)):g("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.actions":o(({item:s})=>[t(b,{variant:"text",size:"small",icon:!0},{default:o(()=>[t(w,{icon:"mdi-dots-vertical"}),t(T,{activator:"parent",location:"bottom"},{default:o(()=>[t(C,{density:"compact",class:"py-0"},{default:o(()=>[(r(!0),m(G,null,V(e.actions,(u,p)=>(r(),m(G,{key:`item-${u.title}-${p}`},[t(_,{onClick:ee=>u.action(s)},{default:o(()=>[t(w,{start:"",size:"small",icon:u.icon},null,8,["icon"]),d(" "+v(u.title),1)]),_:2},1032,["onClick"]),p!==e.actions.length-1?(r(),i(E,{key:0})):g("",!0)],64))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["loading","headers","items","items-per-page"])]),_:1})])}const J=F(q,[["render",H],["__scopeId","data-v-f579388a"]]),Z=D({components:{AgentGroupsList:J,DfBreadcrumbs:P,SvgLoader:X},data(){return{loading:!0,breadcrumbs:[{text:"Agent Groups",to:"/agent-groups/list",exact:!0,disabled:!0}],showForm:!1}},computed:{...$(S,["scanners"])},mounted(){this.loading=!1}});function x(e,n,a,l,L,B){const h=c("DfBreadcrumbs"),A=c("SvgLoader"),y=c("AgentGroupsList");return r(),m("div",null,[t(h,{breadcrumbs:e.breadcrumbs,class:"mb-5"},null,8,["breadcrumbs"]),t(f,{variant:"outlined",class:"my-4"},{default:o(()=>[t(Y,null,{default:o(()=>[t(b,{color:"accent","prepend-icon":"mdi-plus",to:"/agent-groups/new"},{default:o(()=>[d(" New ")]),_:1})]),_:1})]),_:1}),e.loading===!0?(r(),i(A,{key:0})):e.loading===!1&&e.scanners.length>0?(r(),i(y,{key:1})):e.loading===!1&&e.scanners.length===0?(r(),i(j,{key:2,content:"center","align-self":"center"},{default:o(()=>[t(f,{variant:"outlined"},{default:o(()=>[t(R,null,{default:o(()=>[d("No scanners found")]),_:1}),t(z,null,{default:o(()=>[t(b,{variant:"elevated",color:"accent",to:"/scanners"},{default:o(()=>[d(" Add Scanner ")]),_:1})]),_:1})]),_:1})]),_:1})):g("",!0)])}const fe=F(Z,[["render",x]]);export{fe as default};
