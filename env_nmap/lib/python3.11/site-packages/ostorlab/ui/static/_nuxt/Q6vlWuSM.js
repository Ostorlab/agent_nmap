import{Y as W,c as Q,_ as H}from"./Dyb1gHC6.js";import{d as Y,v as m,z as s,A as n,i as y,t as r,a1 as P,x as u,y as v,U as C,a2 as S,L as J,M as Z,a3 as z,W as V,B as d,Y as A,V as x,P as $,Q as T,N as k,a4 as ee,a5 as te,a6 as ae,T as B,O as se,C as ne,D as ie}from"./BuiHH9If.js";import{d as oe,V as I,O as le,D as re,e as O,u as de,b as G,a as ue}from"./DgDmD7eB.js";import{s as ce,V as pe,a as me}from"./CZ85TRIZ.js";import{S as ge}from"./CggeXp-r.js";import{V as he,D as fe}from"./C1DT9QDp.js";import{_ as F}from"./DlAUqK2U.js";import{a as be}from"./CvoSsIOf.js";import{u as ye}from"./Ditas79l.js";import{D as ve}from"./CMv90KeV.js";import{V as j}from"./DuiJo0Wv.js";import{V as K}from"./DppDgiI5.js";import{V as U}from"./BMT2dgHV.js";import"./D8UYu2nU.js";import"./OnHwz_rH.js";import"./BvH6OxSR.js";const De={info:1,important:2,secure:3,hardening:4,potentially:5,low:6,medium:7,high:8,critical:9},ke=Y({name:"VulnzTable",components:{DfRisk:oe},props:{vulnz:{type:Array,required:!0,default:()=>[]},vulnerabilityPreviewLoading:{type:Boolean,default:!1},selectedVulnerabilityKey:{type:String,required:!0}},emits:["goToDetail","goToDetailNewTab","showVulnDetails"],data(){return{headers:[{title:"Show",value:"show",align:"left",width:"4%"},{title:"Risk | CVSS",value:"risk",align:"left",width:"7%"},{title:"Title",value:"title",align:"left",minWidth:"350"},{title:"Short description",value:"description",align:"left"}]}},computed:{kbVulnerabilities(){var a,c,f,D,b,g,i,p,_,N,L,M,l;const e=[];for(const t of this.vulnz)if(((a=t==null?void 0:t.kb)==null?void 0:a.title)==="Use of Outdated Vulnerable Component"){let w=!1;for(const o of t.vulnerabilities.vulnerabilities)if((o==null?void 0:o.metadata)===null||(o==null?void 0:o.metadata)===void 0)w||(e.push({key:o==null?void 0:o.id,goToVulnId:!1,risk:o==null?void 0:o.customRiskRating,title:t.kb.title,securityIssue:t.kb.securityIssue,privacyIssue:t.kb.privacyIssue,targetedByMalware:t.kb.targetedByMalware,targetedByRansomware:t.kb.targetedByRansomware,targetedByNationState:t.kb.targetedByNationState,hasPublicExploit:t.kb.hasPublicExploit,cvssV3:t.highestCvssV3BaseScore,description:t.kb.shortDescription,descriptionFormat:t.kb.shortDescriptionFormat,kb:t.kb}),w=!0);else{const q=(c=o==null?void 0:o.metadata)==null?void 0:c.find(R=>R.name==="dependency_name").value,X=(f=o==null?void 0:o.metadata)==null?void 0:f.find(R=>R.name==="dependency_version").value;e.push({key:o.id,goToVulnId:!0,risk:o.customRiskRating,cvssV3:o.customCvssV3BaseScore,title:`${t.kb.title} for ${q} version ${X}`,securityIssue:t.kb.securityIssue,privacyIssue:t.kb.privacyIssue,targetedByMalware:t.kb.targetedByMalware,targetedByRansomware:t.kb.targetedByRansomware,targetedByNationState:t.kb.targetedByNationState,hasPublicExploit:t.kb.hasPublicExploit,description:t.kb.shortDescription,descriptionFormat:t.kb.shortDescriptionFormat,kb:t.kb})}}else e.push({key:(D=t==null?void 0:t.kb)==null?void 0:D.title,goToVulnId:!1,risk:t.highestRiskRating,title:(b=t==null?void 0:t.kb)==null?void 0:b.title,securityIssue:(g=t==null?void 0:t.kb)==null?void 0:g.securityIssue,privacyIssue:(i=t==null?void 0:t.kb)==null?void 0:i.privacyIssue,targetedByMalware:(p=t==null?void 0:t.kb)==null?void 0:p.targetedByMalware,targetedByRansomware:(_=t==null?void 0:t.kb)==null?void 0:_.targetedByRansomware,targetedByNationState:(N=t==null?void 0:t.kb)==null?void 0:N.targetedByNationState,hasPublicExploit:(L=t==null?void 0:t.kb)==null?void 0:L.hasPublicExploit,cvssV3:t.highestCvssV3BaseScore,description:(M=t==null?void 0:t.kb)==null?void 0:M.shortDescription,descriptionFormat:(l=t==null?void 0:t.kb)==null?void 0:l.shortDescriptionFormat,kb:t.kb});return ce(e).by([{desc:t=>{var w;return De[((w=t==null?void 0:t.risk)==null?void 0:w.toLocaleLowerCase())||""]}},{desc:t=>t.cvssV3}])}},methods:{goToDetail(e){this.$emit("goToDetail",e)},goToDetailNewTab(e){this.$emit("goToDetailNewTab",e)},showVulnDetails(e){this.$emit("showVulnDetails",e)}}}),Ve=["onClick","onMouseup"],we=["onClick","onMouseup"];function Se(e,a,c,f,D,b){const g=y("DfRisk");return r(),m("div",null,[s(he,{hover:"",headers:e.headers,items:e.kbVulnerabilities,"items-per-page":-1},{"item.risk":n(({item:i})=>[s(g,{"cvss-score":i.cvssV3,risk:i.risk,class:"cursor-pointer",onClick:p=>e.goToDetail(i),onMouseup:P(p=>e.goToDetailNewTab(i),["middle"])},null,8,["cvss-score","risk","onClick","onMouseup"])]),"item.title":n(({item:i})=>[u("div",{class:"cursor-pointer",onClick:p=>e.goToDetail(i),onMouseup:P(p=>e.goToDetailNewTab(i),["middle"])},v(i.title),41,Ve)]),"item.description":n(({item:i})=>[u("div",{class:"cursor-pointer",onClick:p=>e.goToDetail(i),onMouseup:P(p=>e.goToDetailNewTab(i),["middle"])},v(i.description),41,we)]),"item.show":n(({item:i})=>[s(C,{size:"small",variant:"text",disabled:e.vulnerabilityPreviewLoading===!0&&i.key!==e.selectedVulnerabilityKey,loading:e.vulnerabilityPreviewLoading===!0&&i.key===e.selectedVulnerabilityKey,icon:"mdi-magnify",onClick:p=>e.showVulnDetails(i)},null,8,["disabled","loading","onClick"])]),_:2},1032,["headers","items"])])}const $e=F(ke,[["render",Se]]),Te=Y({name:"VulnerabilityDetailDialog",components:{VulnerabilityDetail:pe},props:{modelValue:{type:Boolean,default:!1},vuln:{type:Object,default:null},scanId:{type:Number,required:!0},scanner:{type:Object,required:!0}},emits:["update:modelValue","update:loading","afterLeave"],data(){return{loading:!1,dialog:!1}},computed:{vulnKey(){var e;return(e=this.vuln)==null?void 0:e.key}},watch:{modelValue:{immediate:!0,handler(e){this.dialog=e}},dialog(e){this.$emit("update:modelValue",e)},loading(e){this.$emit("update:loading",e),this.vuln!==null&&this.vuln!==void 0&&(e===!0?this.dialog=!1:this.dialog=!0)}}}),Be={id:"vulnerability-detail-container"};function Ce(e,a,c,f,D,b){const g=y("VulnerabilityDetail");return r(),m("div",Be,[s(be,{ref:"dialogRef",modelValue:e.dialog,"onUpdate:modelValue":a[1]||(a[1]=i=>e.dialog=i),scrollable:"",attach:"",eager:"","max-width":"50%",transition:"slide-x-transition",class:"ml-auto",onAfterLeave:a[2]||(a[2]=i=>e.$emit("afterLeave"))},{default:n(()=>[s(I,{class:"dialog-card pa-2",loading:e.loading,style:{"min-height":"100vh"}},{default:n(()=>[s(g,{loading:e.loading,"onUpdate:loading":a[0]||(a[0]=i=>e.loading=i),"vuln-title":e.vulnKey,"scan-id":e.scanId,scanner:e.scanner,"show-breadcrumbs":!1},null,8,["loading","vuln-title","scan-id","scanner"])]),_:1},8,["loading"])]),_:1},8,["modelValue"])])}const Ie=F(Te,[["render",Ce]]),E=1,_e=Y({name:"Index",components:{OXOAssets:le,DfScanProgress:ve,DfConfirmationModal:fe,VulnzTable:$e,VunerabilityDetailDialog:Ie,DfBreadcrumbs:re},data(){return{scanner:{endpoint:"",name:"",apiKey:""},vulenrabilityLoading:!1,vulnDetailsDialog:!1,selectedVulnerability:null,options:{page:1,itemsPerPage:15},vulnerabilityService:new me(this.$axios),scanService:new ge(this.$axios),kb:null,title:"",progress:"UNKNOWN",vulns:[],loadingDialog:!0,stopBtnLoading:!1,deleteScanDialog:!1,archiveBtnLoading:!1,stopScanDialog:!1,assets:[],agentGroup:null,show:!1,editorLanguage:"yaml",editorOptions:{theme:"vs",wordWrap:"on",wordWrapColumn:"on",fontFamily:"Fira Code",automaticLayout:!0,minimap:{enabled:!1},readOnly:!0},breadcrumbs:[{text:"scans",disabled:!1,to:"/scan/list",exact:!0},{text:"Scan",disabled:!1,to:`/scan/${(this._.provides[S]||this.$route).params.scan}`,exact:!0,scans:[]}]}},computed:{...J(ye,["scanners"]),scanId(){return(this._.provides[S]||this.$route).params.scan===void 0||(this._.provides[S]||this.$route).params.scan===null?(this.reportError("Scan ID not provided"),0):parseInt((this._.provides[S]||this.$route).params.scan)},AgentGroupYaml(){var a,c;const e=(a=this.agentGroup)==null?void 0:a.yamlSource;return e==null?"No agent group found":`# Agent Group ID: ${(c=this.agentGroup)==null?void 0:c.id}
${W.stringify(W.parse(e))}`},totalVulnerabilities(){var e;return((e=this.vulns)==null?void 0:e.length)||0}},async mounted(){const e=this.scanners.find(a=>O(a.endpoint)===(this._.provides[S]||this.$route).params.scanner);e===void 0?(this.reportError("Scanner not found"),this.$router.push({name:"scan-list"})):(this.scanner=e,await Promise.allSettled([this.fetchKBVulnerabilities(),this.fetchScans()]),this.updateBreadcrumbs())},methods:{...Z(de,["reportError","reportInfo","reportSuccess"]),async fetchKBVulnerabilities(){var e;try{this.loadingDialog=!0;const a=await this.vulnerabilityService.getKBVulnerabilities(this.scanner,this.scanId);this.kb=a,this.vulns=(a==null?void 0:a.kbVulnerabilities)||[],this.title=a==null?void 0:a.title,this.assets=a==null?void 0:a.assets,this.progress=(e=a==null?void 0:a.progress)==null?void 0:e.toLowerCase(),this.agentGroup=a==null?void 0:a.agentGroup}catch(a){this.reportError(`An error was encountered while fetching the scan: ${a}`)}finally{this.loadingDialog=!1}},showVulnDetails(e){this.selectedVulnerability=e,this.vulnDetailsDialog=!0},goToDetail(e){this.$router.push({name:"scan-scanner-scan-vuln-vuln",params:{scan:this.scanId,scanner:O(this.scanner.endpoint),vuln:e.key??e.kb.id}})},goToDetailNewTab(e){const a=this.$router.resolve(`/scan/${O(this.scanner.endpoint)}/${this.scanId}/vuln/${e.key??e.kb.id}`);window.open(a.href,"_blank")},async fetchScans(){this.breadcrumbs[E].scans=await this.scanService.getScans(this.scanner,{page:1,numberElements:20})},updateBreadcrumbs(){var a,c,f;((c=((a=this.breadcrumbs[E])==null?void 0:a.scans)||[])==null?void 0:c.find(D=>{var b;return D.id===((b=this.kb)==null?void 0:b.id)}))===void 0&&(this.breadcrumbs[E].scans=[...((f=this.breadcrumbs[E])==null?void 0:f.scans)||[],this.kb])},async stopScan(){try{this.stopBtnLoading=!0,await this.scanService.stopScans(this.scanner,[this.scanId]),await this.fetchKBVulnerabilities()}catch(e){this.reportError((e==null?void 0:e.message)||"Error Stopping scan.")}finally{this.stopBtnLoading=!1}},async deleteScan(){try{this.loadingDialog=!0,await this.scanService.deleteScans(this.scanner,[this.scanId]),this.reportSuccess("Scan deleted successfully"),this.$router.push("/scan/list")}catch(e){this.reportError(`An error occurred while deleting the scan: ${e.message}`)}finally{this.loadingDialog=!1}},async exportScan(){try{this.loadingDialog=!0,this.reportInfo("Scan export in progress, this process may take some time."),await this.scanService.exportScan(this.scanner,this.scanId),this.reportSuccess("Scan exported successfully")}catch(e){this.reportError((e==null?void 0:e.message)||"An error occurred while exporting the scan")}finally{this.loadingDialog=!1}}}}),Ne=Q(H),h=e=>(ne("data-v-93c27f6d"),e=e(),ie(),e),Le=h(()=>u("span",null,"Stops scan. Stopped scans can't be restarted.",-1)),Me=h(()=>u("span",null,"Archives scan and removes all findings and artifacts.",-1)),Ae=h(()=>u("span",null,"Exports scan to a zip file.",-1)),Ee=h(()=>u("p",{class:"mb-0 mr-2"}," Title: ",-1)),Re={key:0,class:"mb-0"},Pe={key:1},ze={key:1},Oe=h(()=>u("p",{class:"mb-0 mr-2"}," Targets: ",-1)),Ge=h(()=>u("p",{class:"mb-0 mr-2"}," Progress: ",-1)),Ke=h(()=>u("p",{class:"mb-0 mr-2"}," Date: ",-1)),Ue={key:0,class:"mb-0"},Ye={key:1},Fe={key:1},We=h(()=>u("p",{class:"mb-0 mr-2"}," Scanner: ",-1)),je={key:0},qe={key:1},Xe=h(()=>u("span",null,"Agent Group",-1));function Qe(e,a,c,f,D,b){const g=y("DfConfirmationModal"),i=y("VunerabilityDetailDialog"),p=y("DfBreadcrumbs"),_=y("OXOAssets"),N=y("DfScanProgress"),L=Ne,M=y("VulnzTable");return r(),m("div",null,[s(g,{modelValue:e.deleteScanDialog,"onUpdate:modelValue":a[0]||(a[0]=l=>e.deleteScanDialog=l),title:"Are you sure you would like to archive this scan?","cancel-button-text":"Cancel","confirm-button-text":"Delete","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-archive-arrow-down-outline",onConfirm:e.deleteScan},null,8,["modelValue","onConfirm"]),s(g,{modelValue:e.stopScanDialog,"onUpdate:modelValue":a[1]||(a[1]=l=>e.stopScanDialog=l),title:"Are you sure you would like to stop the scan?",description:"A stopped scan cannot be resumed.","cancel-button-text":"Cancel","confirm-button-text":"Stop","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-stop-circle-outline",onConfirm:e.stopScan},null,8,["modelValue","onConfirm"]),s(i,{loading:e.vulenrabilityLoading,"onUpdate:loading":a[2]||(a[2]=l=>e.vulenrabilityLoading=l),"model-value":e.vulnDetailsDialog,"onUpdate:modelValue":a[3]||(a[3]=l=>e.vulnDetailsDialog=l),vuln:e.selectedVulnerability,"scan-id":e.scanId,scanner:e.scanner,onAfterLeave:a[4]||(a[4]=l=>e.selectedVulnerability=null)},null,8,["loading","model-value","vuln","scan-id","scanner"]),s(p,{"scan-id":e.scanId,breadcrumbs:e.breadcrumbs,scanner:e.scanner,class:"mb-5"},null,8,["scan-id","breadcrumbs","scanner"]),s(I,{class:"d-flex pl-3 py-3 mt-3",variant:"outlined"},{default:n(()=>[s(K,{bottom:""},{activator:n(({props:l})=>[s(C,z({disabled:e.progress==="stopped"||e.progress==="done"||e.loadingDialog===!0,loading:e.stopBtnLoading,class:"mr-2"},l,{onClick:a[5]||(a[5]=t=>e.stopScanDialog=!0)}),{default:n(()=>[s(V,{start:""},{default:n(()=>[d(" mdi-stop-circle-outline ")]),_:1}),d(" Stop ")]),_:2},1040,["disabled","loading"])]),default:n(()=>[Le]),_:1}),s(K,{bottom:""},{activator:n(({props:l})=>[s(C,z({loading:e.archiveBtnLoading,class:"mr-2"},l,{onClick:a[6]||(a[6]=t=>e.deleteScanDialog=!0)}),{default:n(()=>[s(V,{start:""},{default:n(()=>[d(" mdi-delete-outline ")]),_:1}),d(" Delete ")]),_:2},1040,["loading"])]),default:n(()=>[Me]),_:1}),s(K,{bottom:""},{activator:n(({props:l})=>[s(C,z({class:"mr-2"},l,{onClick:e.exportScan}),{default:n(()=>[s(V,{start:""},{default:n(()=>[d(" mdi-file-export-outline ")]),_:1}),d(" Export ")]),_:2},1040,["onClick"])]),default:n(()=>[Ae]),_:1})]),_:1}),s(j,{class:"mt-4 align-stretch"},{default:n(()=>[s(U,{cols:"12",lg:"12"},{default:n(()=>[s(I,{loading:e.loadingDialog,height:"100%",variant:"outlined"},{default:n(()=>[s(G,null,{default:n(()=>[s(V,{start:""},{default:n(()=>[d(" mdi-shield-check-outline ")]),_:1}),d(" Scan Details ")]),_:1}),s(A),s(x,null,{default:n(()=>[s($,null,{default:n(()=>[s(T,{class:"d-flex align-center"},{default:n(()=>[Ee,e.title!==null&&e.title!==""?(r(),m("p",Re,v(e.title),1)):(r(),m("div",Pe,[e.loadingDialog===!0?(r(),k(B,{key:0,variant:"tonal",size:"small",label:"",style:{width:"80px"}})):(r(),m("span",ze,"-"))]))]),_:1})]),_:1}),s($,null,{default:n(()=>[s(T,{class:"d-flex align-center"},{default:n(()=>[Oe,e.loadingDialog===!0?(r(),k(B,{key:0,variant:"tonal",label:"",style:{width:"90px"}})):(r(),k(_,{key:1,assets:e.assets},null,8,["assets"]))]),_:1})]),_:1}),s($,null,{default:n(()=>[s(T,{class:"d-flex align-center"},{default:n(()=>[Ge,e.loadingDialog===!0?(r(),k(B,{key:0,variant:"tonal",size:"small",label:"",style:{width:"60px"}})):(r(),k(N,{key:1,progress:e.progress},null,8,["progress"]))]),_:1})]),_:1}),s($,null,{default:n(()=>[s(T,{class:"d-flex align-center"},{default:n(()=>[Ke,e.loadingDialog===!1&&e.kb!==null?(r(),m("p",Ue,v(e.$moment(e.kb.createdTime).format("MMMM Do YYYY, k:mm:ss")),1)):(r(),m("div",Ye,[e.loadingDialog===!0?(r(),k(B,{key:0,variant:"tonal",size:"x-small",label:"",style:{width:"180px"}})):(r(),m("span",Fe,"-"))]))]),_:1})]),_:1}),s($,null,{default:n(()=>[s(T,{class:"d-flex align-center"},{default:n(()=>[We,u("div",null,[(e.scanner.name||"").trim()!==""?(r(),m("p",je,[d(v(e.scanner.name)+" (",1),u("code",null,v(e.scanner.endpoint),1),d(") ")])):(r(),m("code",qe,v(e.scanner.endpoint),1))])]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}),s(I,{class:"mt-12",variant:"outlined"},{default:n(()=>[s(G,{class:"cursor-pointer",onClick:a[7]||(a[7]=l=>e.show=!e.show)},{default:n(()=>[s(j,{align:"center",justify:"space-between",class:"w-100"},{default:n(()=>[s(U,{class:"d-flex align-center"},{default:n(()=>[s(V,{start:""},{default:n(()=>[d(" mdi-format-list-group ")]),_:1}),Xe]),_:1}),s(U,{class:"d-flex justify-end"},{default:n(()=>[s(C,{icon:e.show?"mdi-chevron-up":"mdi-chevron-down",elevation:"0"},null,8,["icon"])]),_:1})]),_:1})]),_:1}),s(A),s(ee,null,{default:n(()=>[te(u("div",null,[s(A),s(ue,null,{default:n(()=>[s(L,{modelValue:e.AgentGroupYaml,"onUpdate:modelValue":a[8]||(a[8]=l=>e.AgentGroupYaml=l),lang:e.editorLanguage,options:e.editorOptions,style:{"min-height":"300px"}},null,8,["modelValue","lang","options"])]),_:1})],512),[[ae,e.show]])]),_:1})]),_:1}),s(I,{loading:e.loadingDialog,class:"mt-12",justify:"space-around",variant:"outlined"},{default:n(()=>[s(G,null,{default:n(()=>[s(V,{start:""},{default:n(()=>[d(" mdi-bug-outline ")]),_:1}),d(" Vulnerabilities "),e.totalVulnerabilities!==null?(r(),k(B,{key:0,size:"small",class:"ml-2"},{default:n(()=>[d(v(e.totalVulnerabilities),1)]),_:1})):se("",!0)]),_:1}),s(A),s(M,{"vulnerability-preview-loading":e.vulenrabilityLoading,vulnz:e.vulns,"selected-vulnerability-key":e.selectedVulnerability!==null?e.selectedVulnerability.key:null,onGoToDetail:e.goToDetail,onGoToDetailNewTab:e.goToDetailNewTab,onShowVulnDetails:e.showVulnDetails},null,8,["vulnerability-preview-loading","vulnz","selected-vulnerability-key","onGoToDetail","onGoToDetailNewTab","onShowVulnDetails"])]),_:1},8,["loading"])])}const pt=F(_e,[["render",Qe],["__scopeId","data-v-93c27f6d"]]);export{pt as default};
