import{u as pe}from"./Ditas79l.js";import{ad as fe,ag as ge,j as A,ax as m,aS as he,az as Se,ai as be,z as t,R as V,a3 as k,Y as X,d as q,M as ve,v as y,A as s,i as g,t as c,U as w,W as B,B as l,T as ye,y as v,X as De,V as Ve,S as z,N as D,x as Pe,Q as ke,P as we,L as Ce,O as Te}from"./BuiHH9If.js";import{O as Ae,e as Be,u as $e,V as $,b as W,D as _e,c as Ee}from"./DgDmD7eB.js";import{S as Le}from"./CggeXp-r.js";import{D as Ie}from"./CMv90KeV.js";import{m as Oe,a as Ne,b as Me,c as Re,d as Fe,e as Ge,f as He,u as Ue,p as Ye,g as je,h as Xe,i as qe,j as ze,k as We,l as Qe,n as G,o as H,q as U,r as Y,D as Je}from"./C1DT9QDp.js";import{_ as Q}from"./DlAUqK2U.js";import{S as Ke}from"./BY0pkBHE.js";import{V as Ze}from"./DuiJo0Wv.js";import{V as j}from"./BMT2dgHV.js";import"./DppDgiI5.js";import"./BvH6OxSR.js";import"./CvoSsIOf.js";const xe=fe({itemsLength:{type:[Number,String],required:!0},...Oe(),...Ne(),...Me()},"VDataTableServer"),et=ge()({name:"VDataTableServer",props:xe(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0},setup(e,n){let{attrs:C,slots:a}=n;const{groupBy:p}=Re(e),{sortBy:u,multiSort:f,mustSort:h}=Fe(e),{page:d,itemsPerPage:o}=Ge(e),r=A(()=>parseInt(e.itemsLength,10)),{columns:S,headers:_}=He(e,{groupBy:p,showSelect:m(e,"showSelect"),showExpand:m(e,"showExpand")}),{items:P}=Ue(e,S),{toggleSort:E}=Ye({sortBy:u,multiSort:f,mustSort:h,page:d}),{opened:J,isGroupOpen:K,toggleGroup:Z,extractRows:x}=je({groupBy:p,sortBy:u}),{pageCount:ee,setItemsPerPage:te}=Xe({page:d,itemsPerPage:o,itemsLength:r}),{flatItems:L}=qe(P,p,J),{isSelected:ae,select:se,selectAll:oe,toggleSelect:ne,someSelected:re,allSelected:le}=ze(e,{allItems:P,currentPage:P}),{isExpanded:ie,toggleExpand:ce}=We(e),I=A(()=>x(P.value));Qe({page:d,itemsPerPage:o,sortBy:u,groupBy:p,search:m(e,"search")}),he("v-data-table",{toggleSort:E,sortBy:u}),Se({VDataTableRows:{hideNoData:m(e,"hideNoData"),noDataText:m(e,"noDataText"),loading:m(e,"loading"),loadingText:m(e,"loadingText")}});const i=A(()=>({page:d.value,itemsPerPage:o.value,sortBy:u.value,pageCount:ee.value,toggleSort:E,setItemsPerPage:te,someSelected:re.value,allSelected:le.value,isSelected:ae,select:se,selectAll:oe,toggleSelect:ne,isExpanded:ie,toggleExpand:ce,isGroupOpen:K,toggleGroup:Z,items:I.value.map(T=>T.raw),internalItems:I.value,groupedItems:L.value,columns:S.value,headers:_.value}));be(()=>{const T=G.filterProps(e),de=H.filterProps(e),ue=U.filterProps(e),me=Y.filterProps(e);return t(Y,k({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},me),{top:()=>{var b;return(b=a.top)==null?void 0:b.call(a,i.value)},default:()=>{var b,O,N,M,R,F;return a.default?a.default(i.value):t(V,null,[(b=a.colgroup)==null?void 0:b.call(a,i.value),!e.hideDefaultHeader&&t("thead",{key:"thead",class:"v-data-table__thead",role:"rowgroup"},[t(H,k(de,{sticky:e.fixedHeader}),a)]),(O=a.thead)==null?void 0:O.call(a,i.value),!e.hideDefaultBody&&t("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[(N=a["body.prepend"])==null?void 0:N.call(a,i.value),a.body?a.body(i.value):t(U,k(C,ue,{items:L.value}),a),(M=a["body.append"])==null?void 0:M.call(a,i.value)]),(R=a.tbody)==null?void 0:R.call(a,i.value),(F=a.tfoot)==null?void 0:F.call(a,i.value)])},bottom:()=>a.bottom?a.bottom(i.value):!e.hideDefaultFooter&&t(V,null,[t(X,null,null),t(G,T,{prepend:a["footer.prepend"]})])})})}}),tt=[{title:"Target",align:"left",sortable:!1,key:"asset"},{title:"Title",align:"left",sortable:!1,key:"title",width:"24%"},{title:"Created time (UTC)",align:"left",sortable:!1,key:"CreatedTime",width:"14%"},{title:"Progress",align:"left",sortable:!1,key:"Progress",width:"8%"}],at=q({components:{OXOAssets:Ae,DfScanProgress:Ie,DfConfirmationModal:Je},props:{scanner:{type:Object,required:!0}},data(){return{selected:[],service:new Le(this.$axios),scans:[],deleteScanDialog:!1,loading:!0,options:{itemsPerPage:15,page:1,sortDesc:[!0],sortBy:[{key:"CreatedTime",order:"desc"}]},onActionScan:null,stopDialog:!1,headers:tt,currentPage:0}},watch:{options:{handler(){this.fetchScans()},deep:!0}},methods:{...ve($e,["reportSuccess","reportError"]),goToScan(e,n){this.$router.push({name:"scan-scanner-scan",params:{scan:n.item.id,scanner:Be(this.scanner.endpoint)}})},stopScans(e){this.onActionScan=e,this.stopDialog=!0},async confirmStopSelectedScans(){try{await this.service.stopScans(this.scanner,this.selected),await this.fetchScans()}catch(e){this.reportError((e==null?void 0:e.message)||"An error occurred while stopping the scans")}finally{this.onActionScan=null,this.selected=[]}},deleteScans(e){this.onActionScan=e,this.deleteScanDialog=!0},async confirmDeleteSelectedScans(){if(!(this.onActionScan===null||this.onActionScan===void 0)){try{this.loading=!0,await this.service.deleteScans(this.scanner,this.selected),this.reportSuccess("Scans deleted successfully")}catch(e){this.reportError(`An error occurred while deleting the scan: ${e==null?void 0:e.message}`)}finally{this.onActionScan=null,this.loading=!1,this.selected=[]}await this.fetchScans()}},async fetchScans(){this.loading=!0;try{if(!this.scanner)return;this.scans=await this.service.getScans(this.scanner,{numberElements:this.options.itemsPerPage,page:this.options.page})}catch(e){this.reportError(`An error occurred while fetching scans from: ${this.scanner.name||this.scanner.endpoint}: ${e.message}`)}finally{this.loading=!1}}}}),st={class:"d-flex align-center"};function ot(e,n,C,a,p,u){const f=g("DfConfirmationModal"),h=g("DfScanProgress"),d=g("OXOAssets");return c(),y("div",null,[t(f,{modelValue:e.stopDialog,"onUpdate:modelValue":n[0]||(n[0]=o=>e.stopDialog=o),title:"Are you sure you would like to stop the selected scans?",description:"A stopped scan cannot be resumed.","cancel-button-text":"Cancel","confirm-button-text":"Stop","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-stop-circle-outline",onConfirm:e.confirmStopSelectedScans},null,8,["modelValue","onConfirm"]),t(f,{modelValue:e.deleteScanDialog,"onUpdate:modelValue":n[1]||(n[1]=o=>e.deleteScanDialog=o),title:"Are you sure you would like to archive the selected scans?","cancel-button-text":"Cancel","confirm-button-text":"Delete","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-archive-arrow-down-outline",onConfirm:e.confirmDeleteSelectedScans},null,8,["modelValue","onConfirm"]),t($,{variant:"outlined",class:"mb-5"},{default:s(()=>[t(w,{icon:e.mdi-e.refresh,disabled:e.selected.length===0,class:"mx-1 my-1",onClick:e.stopScans},{default:s(()=>[t(B,{start:""},{default:s(()=>[l(" mdi-stop-circle-outline ")]),_:1}),l("Stop ")]),_:1},8,["icon","disabled","onClick"]),t(w,{disabled:e.selected.length===0,class:"mx-1 my-1",onClick:e.deleteScans},{default:s(()=>[t(B,{start:""},{default:s(()=>[l(" mdi-trash-can-outline ")]),_:1}),l("Delete ")]),_:1},8,["disabled","onClick"])]),_:1}),t($,{variant:"outlined"},{default:s(()=>[t(W,{class:"pt-2 pl-2"},{default:s(()=>[t(ye,{label:""},{default:s(()=>[l(v(e.scanner.name||e.scanner.endpoint),1)]),_:1})]),_:1}),t(et,{options:e.options,"onUpdate:options":n[2]||(n[2]=o=>e.options=o),modelValue:e.selected,"onUpdate:modelValue":n[3]||(n[3]=o=>e.selected=o),hover:"","show-select":"",headers:e.headers,items:e.scans,"items-length":e.service.totalScans,loading:e.loading,"items-per-page-options":[15,50,200,-1],"items-per-page":e.options.itemsPerPage,density:"comfortable","onClick:row":e.goToScan},{"item.Progress":s(({item:o})=>[t(h,{progress:o.progress||"unknown"},null,8,["progress"])]),"item.CreatedTime":s(({item:o})=>[l(v(e.$moment(o.createdTime).format("MMMM Do YYYY, k:mm:ss")),1)]),"item.Action":s(({item:o})=>[t(De,{bottom:"",left:"","offset-y":""},{activator:s(({props:r})=>[t(w,k({icon:"mdi-dots-vertical"},r,{variant:"flat",size:"small"}),null,16)]),default:s(()=>[t(Ve,{density:"compact"},{default:s(()=>[(c(!0),y(V,null,z(e.actions,(r,S)=>(c(),y(V,null,[r.divider!==void 0?(c(),D(X,{key:`divider-${S}`,class:"mb-2 mt-2"})):(c(),D(we,{key:`item-${S}`,density:"compact",disabled:r.disabled?r.disabled(o):!1,onClick:_=>r.action&&r.action(o)},{default:s(()=>[Pe("div",st,[t(B,{start:""},{default:s(()=>[l(v(r.icon),1)]),_:2},1024),t(ke,null,{default:s(()=>[l(v(r.title),1)]),_:2},1024)])]),_:2},1032,["disabled","onClick"]))],64))),256))]),_:2},1024)]),_:2},1024)]),"item.asset":s(({item:o})=>[t(d,{assets:o.assets||[]},null,8,["assets"])]),"item.title":s(({item:o})=>[l(v(o.title||"-"),1)]),_:2},1032,["options","modelValue","headers","items","items-length","loading","items-per-page","onClick:row"])]),_:1})])}const nt=Q(at,[["render",ot]]),rt=q({components:{ScanList:nt,DfBreadcrumbs:_e,SvgLoader:Ke},data(){return{loading:!0,breadcrumbs:[{text:"Scans",to:"/scan/list",exact:!0,disabled:!0}]}},computed:{...Ce(pe,["scanners"])},mounted(){this.loading=!1}});function lt(e,n,C,a,p,u){const f=g("DfBreadcrumbs"),h=g("SvgLoader"),d=g("scan-list");return c(),y("div",null,[t(f,{breadcrumbs:e.breadcrumbs,class:"mb-5"},null,8,["breadcrumbs"]),t(Ze,{justify:"center"},{default:s(()=>[e.loading===!0?(c(),D(h,{key:0})):e.loading===!1&&e.scanners.length>0?(c(!0),y(V,{key:1},z(e.scanners,o=>(c(),D(j,{key:o.endpoint,cols:"12"},{default:s(()=>[t(d,{scanner:o},null,8,["scanner"])]),_:2},1024))),128)):e.loading===!1&&e.scanners.length===0?(c(),D(j,{key:2,content:"center","align-self":"center"},{default:s(()=>[t($,{variant:"outlined"},{default:s(()=>[t(W,null,{default:s(()=>[l("No scanners found")]),_:1}),t(Ee,null,{default:s(()=>[t(w,{variant:"elevated",color:"accent",to:"/scanners"},{default:s(()=>[l(" Add Scanner ")]),_:1})]),_:1})]),_:1})]),_:1})):Te("",!0)]),_:1})])}const Dt=Q(rt,[["render",lt]]);export{Dt as default};
